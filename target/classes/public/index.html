<!-- public/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTCondor Cluster Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f7fa; }
        .card { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .alert { background: #ffebee; color: #c62828; padding: 10px; border-left: 4px solid #f44336; margin: 10px 0; }
        .success { background: #e8f5e9; color: #2e7d32; border-left: 4px solid #4caf50; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 10px; overflow: auto; font-size: 12px; }
    </style>
</head>
<body>
<h1>üî¨ HTCondor Cluster Dashboard</h1>

<div class="card">
    <h3>–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è</h3>
    <div id="ansible-stage">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<div class="card">
    <h3>–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞</h3>
    <div id="cluster-status">‚Äî</div>
</div>

<div class="card">
    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
    <button onclick="sendCommand('collect-logs')">–°–æ–±—Ä–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏</button>
    <div id="command-result"></div>
</div>

<div class="card">
    <h3>–û–ø–æ–≤–µ—â–µ–Ω–∏—è</h3>
    <div id="alerts">–ù–µ—Ç –æ–ø–æ–≤–µ—â–µ–Ω–∏–π</div>
</div>

<script>
    async function updateStatus() {
        try {
            const res = await fetch('/api/status');
            const data = await res.json();

            document.getElementById('ansible-stage').textContent = data.ansibleStage || '‚Äî';
            document.getElementById('cluster-status').textContent = data.htcondorStatus || '‚Äî';

            const alertsDiv = document.getElementById('alerts');
            if (data.alerts && data.alerts.length > 0) {
                alertsDiv.innerHTML = data.alerts.map(a => `<div class="alert">${a}</div>`).join('');
            } else {
                alertsDiv.innerHTML = '–ù–µ—Ç –æ–ø–æ–≤–µ—â–µ–Ω–∏–π';
            }
        } catch (e) {
            console.error(e);
        }
    }

    async function sendCommand(action) {
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';

        const res = await fetch(`/api/${action}`, { method: 'POST' });
        const result = await res.json();
        const resultDiv = document.getElementById('command-result');

        if (result.error) {
            resultDiv.innerHTML = `<div class="alert">–û—à–∏–±–∫–∞: ${result.error}</div>`;
        } else {
            resultDiv.innerHTML = `<div class="success">${result.message}</div>`;
            if (action === 'collect-logs') {
                setTimeout(() => {
                    window.open('/logs', '_blank');
                }, 2000);
            }
        }

        btn.disabled = false;
        btn.textContent = action === '–°–æ–±—Ä–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏';
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
    setInterval(updateStatus, 2000);
    updateStatus(); // —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
</script>
</body>
</html>